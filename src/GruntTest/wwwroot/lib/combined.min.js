!function(a){app.directive("blsCols",["$log","$compile","$templateCache","$timeout",function(a,b,c,d){return this.link={post:function(b,c,d,e){var f=e[0],g=e[1];a.debug("    Link => blsCols"),f.setCols(g.getCols())}},this.controller=["$scope","$filter","$timeout","$element","$log","localStorageService","dropableservice",function(a,b,c,d,e,f,g){e.debug("    controller => blsCols");var h=[];this.addCol=function(a){h.push(a)},this.getCols=function(){return h}}],{priority:0,require:["^blsTable","blsCols"],restrict:"E",link:this.link,controller:this.controller}}]).directive("blsCol",["$log","$compile","$templateCache","$timeout",function(b,c,d,e){return this.link={pre:function(c,d,e,f){var g=f[1];b.debug("        Link => blsCol"),g.addCol({title:e.title||e.fieldName,fieldName:e.fieldName,resize:a.isDefined(e.resize),tpl:d.html(),sortable:a.isDefined(e.sort),dragable:a.isDefined(e.dragable)})}},this.controller=["$scope","$filter","$timeout","$element","$log","localStorageService","dropableservice",function(a,b,c,d,e,f,g){e.debug("        controller => blsCol")}],{priority:-1,require:["^blsTable","^blsCols","blsCol"],restrict:"E",link:this.link,controller:this.controller}}])}(window.angular),function(a){"use strict";app.directive("blsGrid",function(){return{restrict:"E",transclude:!0,scope:{model:"=ngModel",getSlaveView:"&",gridClass:"@",options:"=",func:"&"},templateUrl:"template/blsGrid/blsGrid.html",controller:["$scope","$filter","$timeout","$element","$log","localStorageService","dropableservice",function(b,c,d,e,f,g,h){b.source;var i={multiSelection:!0,search:{searchText:"",searchClass:"form-control"},pagination:{pageLength:5,pageIndex:1,pager:{nextTitle:"Suivant",perviousTitle:"Précédent",maxSize:3},itemsPerPage:{prefixStorage:"ipp_",selected:10,range:[10,20]}}};b.colOrderConfig=[],b.options=a.extend({},i,b.options),b.columns=[],b.isLoading=!0,b.dataFilterSearch=b.data=[],b.offset=0,b.selectedRows=[],b.actionsEnabled=null!=b.options.actions,b.uniqueId=b.options.pagination.itemsPerPage.prefixStorage+e[0].id,b.storageIds={predicateId:"prd_"+b.uniqueId,reverseId:"rvs_"+b.uniqueId,itemsPerPageId:"ipp_"+b.uniqueId,colReorderDataKey:"crdKey_"+b.uniqueId,colResizeDataKey:"crsKey_"+b.uniqueId},b.options.pagination.itemsPerPage.selected=g.get(b.storageIds.itemsPerPageId)||b.options.pagination.itemsPerPage.selected,b.$watchCollection("source",function(c,d){b.data=[],b.isLoading=!0,c!=d&&(a.forEach(b.source,function(c,d){b.actionsEnabled&&(c.actions=b.options.actions),b.data.push(c),b.columns.length>0||(a.forEach(c,function(a,c){"actions"!=c&&b.actionsEnabled&&b.columns.push({id:c,displayName:b.options.colDef[c]?b.options.colDef[c].displayName:c})}),b.actionsEnabled&&b.columns.push({id:"actions",displayName:"Actions"}),b.initResizableColumns())}),b.reverse=g.get(b.storageIds.reverseId),b.predicate=g.get(b.storageIds.predicateId)||(void 0==b.columns[0]?"":b.columns[0].id),b.options.pagination.itemsPerPage&&b.options.pagination.itemsPerPage.range&&b.options.pagination.itemsPerPage.range.indexOf(b.options.pagination.pageLength)<1&&(b.options.pagination.pageLength=g.get(b.storageIds.itemsPerPageId)||b.options.pagination.itemsPerPage.range[0]),b.colOrderConfig=h.initReorderColumns(b.columns,b.data,b.storageIds.colReorderDataKey),f.debug("init colOrderConfig : "+b.colOrderConfig)),b.isLoading=!1});var j=function(){if(b.columns=[],b.data=[],b.isLoading=!0,f.debug("initialise BlsGrid"),b.func&&a.isDefined(b.func())){if(!a.isDefined(b.func().then))throw"func must a be promise!!";b.func({pageIndex:b.options.pagination.pageIndex,pageLength:b.options.pagination.itemsPerPage.selected}).then(function(a){d(function(){b.$apply(function(){b.dataFilterSearch=b.source=a.data,b.isLoading=!1})},0)},function(a){f.error(a),b.isLoading=!1})}else b.$watchCollection("model",function(a,c){f.debug("is model passed => "+b.model),b.dataFilterSearch=b.source=a});b.isLoading=!1};b.initResizableColumns=function(){b.$evalAsync(function(){$(e).find("#"+b.storageIds.colResizeDataKey).colResizable({fixed:!0,liveDrag:!0,postbackSafe:!0,partialRefresh:!0})})},b.order=function(a){b.reverse=b.predicate===a?!b.reverse:!1,b.predicate=a,b.saveUserData({key:b.storageIds.predicateId,val:b.predicate}),b.saveUserData({key:b.storageIds.reverseId,val:b.reverse})},b.glyphOrder=function(a){return a!=b.predicate?"":(b.reverse=g.get(b.storageIds.reverseId)||b.reverse,b.reverse?"fa-sort-asc":"fa-sort-desc")},b.$watch("options.pagination.pageIndex",function(a,c){b.refreshOffset()}),b.refreshOffset=function(){b.offset=(b.options.pagination.pageIndex-1)*b.options.pagination.itemsPerPage.selected},b.updateRecordsCount=function(){b.saveUserData({key:b.storageIds.itemsPerPageId,val:b.options.pagination.itemsPerPage.selected}),b.options.pagination.pageLength=b.options.pagination.itemsPerPage.selected,b.dataFilterSearch=c("filter")(b.data,b.options.search.searchText)},b.$watch("options.search.searchText",function(a,d){b.dataFilterSearch=c("filter")(b.data,a),f.debug("options.search.searchText triggred => "+b.dataFilterSearch.length)}),b.saveUserData=function(a){g.isSupported&&g.set(a.key,a.val)},b.$on("flushEvent",function(a){f.debug(g.keys()),f.debug("clearUserDataEvent intercepted"),g.isSupported&&g.clearAll("^(.)+"+b.uniqueId+"$")}),b.$on("toggleSelectAllEvent",function(a){f.debug("toggleSelectAllEvent intercepted"),b.selectedRows=a.targetScope.selectedAll?b.data:[]}),b.$on("refreshEvent",function(a){f.debug("refreshEvent intercepted"),j()}),b.isActionCol=function(a){return"actions"==a.id},b.toggleSelectedRow=function(a){b.options.multiSelection?b.selectedRows.indexOf(a)>-1?b.selectedRows.splice(b.selectedRows.indexOf(a),1):b.selectedRows.push(a):b.selectedRows=[a]},b.handleDrop=function(a,d){var e=c("getIndexByProperty")("id",a,b.columns),f=c("getIndexByProperty")("id",$(d).data("originalTitle"),b.columns);h.swapArrayElements(b.columns,e,f),h.swapArrayElements(b.data,e,f),h.swapArrayElements(b.colOrderConfig,e,f)},b.handleDrag=function(a){b.dragHead=a.replace(/["']/g,"")},b.$watchCollection("columns",function(a,c){a!=c&&a&&h.saveConfig(b.storageIds.colReorderDataKey,b.colOrderConfig)}),j()}]}})}(window.angular),function(a){"use strict";app.directive("blsGridAsync",function(){return{restrict:"E",transclude:!0,require:"^ngModel",scope:{ngModel:"=",gridClass:"@",options:"=",funcAsync:"&"},templateUrl:"template/blsGrid/blsGridAsync.html",controller:["$scope","$filter","$timeout","$element","$log","localStorageService","dropableservice",function(b,c,d,e,f,g,h){var i={multiSelection:!0,search:{searchText:"",searchClass:"form-control"},pagination:{pageLength:5,pageIndex:1,pager:{nextTitle:"Suivant",perviousTitle:"Précédent",maxSize:3},itemsPerPage:{prefixStorage:"ipp_",selected:10,range:[10,20]}}};b.colOrderConfig=[],b.options=a.extend({},i,b.options),b.columns=[],b.isLoading=!0,b.data=[],b.selectedRows=[],b.actionsEnabled=null!=b.options.actions,b.uniqueId=b.options.pagination.itemsPerPage.prefixStorage+e[0].id,b.storageIds={predicateId:"prd_"+b.uniqueId,reverseId:"rvs_"+b.uniqueId,itemsPerPageId:"ipp_"+b.uniqueId,colReorderDataKey:"crdKey_"+b.uniqueId,colResizeDataKey:"crsKey_"+b.uniqueId},b.options.pagination.itemsPerPage.selected=g.get(b.storageIds.itemsPerPageId)||b.options.pagination.itemsPerPage.selected,b.$watchCollection("ngModel.data",function(c,d){b.data=[],b.isLoading=!0,c!=d&&(a.forEach(c,function(c,d){b.actionsEnabled&&(c.actions=b.options.actions),b.data.push(c),b.columns.length>0||(a.forEach(c,function(a,c){"actions"!=c&&b.actionsEnabled&&b.columns.push({id:c,displayName:b.options.colDef[c]?b.options.colDef[c].displayName:c})}),b.actionsEnabled&&b.columns.push({id:"actions",displayName:"Actions"}),b.initResizableColumns())}),b.options.pagination.itemsPerPage&&b.options.pagination.itemsPerPage.range&&b.options.pagination.itemsPerPage.range.indexOf(b.options.pagination.pageLength)<1&&(b.options.pagination.pageLength=g.get(b.storageIds.itemsPerPageId)||b.options.pagination.itemsPerPage.range[0]),b.colOrderConfig=h.initReorderColumns(b.columns,b.data,b.storageIds.colReorderDataKey),f.debug("init colOrderConfig : "+b.colOrderConfig)),b.isLoading=!1});var j=function(){f.debug("initialise BlsGrid Async"),f.debug(b.options.pagination.pageLength),f.debug(b.options.pagination.pageIndex),b.columns=[],b.data=[],b.isLoading=!0,k()},k=function(){a.isDefined(b.funcAsync)&&(b.reverse=g.get(b.storageIds.reverseId),b.predicate=g.get(b.storageIds.predicateId)||(void 0==b.columns[0]?"":b.columns[0].id),b.funcAsync({pageIndex:b.options.pagination.pageIndex,pageLength:b.options.pagination.itemsPerPage.selected,searchedText:b.options.search.searchText,orderBy:b.predicate,order:b.reverse}))};b.initResizableColumns=function(){b.$evalAsync(function(){$(e).find("#"+b.storageIds.colResizeDataKey).colResizable({fixed:!0,liveDrag:!0,postbackSafe:!0,partialRefresh:!0})})},b.order=function(a){b.reverse=b.predicate===a?!b.reverse:!1,b.predicate=a,b.saveUserData({key:b.storageIds.predicateId,val:b.predicate}),b.saveUserData({key:b.storageIds.reverseId,val:b.reverse}),k()},b.glyphOrder=function(a){return a!=b.predicate?"":(b.reverse=g.get(b.storageIds.reverseId)||b.reverse,b.reverse?"fa-sort-asc":"fa-sort-desc")},b.$watch("options.pagination.pageIndex",function(a,c){a!=c&&(b.options.pagination.pageIndex=a++,k())}),b.updateRecordsCount=function(){b.saveUserData({key:b.storageIds.itemsPerPageId,val:b.options.pagination.itemsPerPage.selected}),b.options.pagination.pageLength=b.options.pagination.itemsPerPage.selected,k()},b.$watch("options.search.searchText",function(a,b){a!=b&&k()}),b.saveUserData=function(a){g.isSupported&&g.set(a.key,a.val)},b.$on("flushEvent",function(a){f.debug(g.keys()),f.debug("clearUserDataEvent intercepted"),g.isSupported&&g.clearAll("^(.)+"+b.uniqueId+"$")}),b.$on("toggleSelectAllEvent",function(a){f.debug("toggleSelectAllEvent intercepted => "+a.targetScope.selectedAll),b.selectedRows=a.targetScope.selectedAll?b.data:[]}),b.$on("refreshEvent",function(a){f.debug("refreshEvent intercepted"),j()}),b.isActionCol=function(a){return"actions"==a.id},b.toggleSelectedRow=function(a){b.options.multiSelection?b.selectedRows.indexOf(a)>-1?b.selectedRows.splice(b.selectedRows.indexOf(a),1):b.selectedRows.push(a):b.selectedRows=[a]},b.handleDrop=function(a,d){var e=c("getIndexByProperty")("id",a,b.columns),f=c("getIndexByProperty")("id",$(d).data("originalTitle"),b.columns);h.swapArrayElements(b.columns,e,f),h.swapArrayElements(b.data,e,f),h.swapArrayElements(b.colOrderConfig,e,f)},b.handleDrag=function(a){b.dragHead=a.replace(/["']/g,"")},b.$watchCollection("columns",function(a,c){a!=c&&a&&h.saveConfig(b.storageIds.colReorderDataKey,b.colOrderConfig)}),j()}]}}),a.module("bls_tpls",[]).run(["$templateCache","$templateRequest",function(a,b){b("templates/blsContainer.html"),b("templates/blsTr.html"),b("templates/blsCompositeGrid.html"),a.put("template/blsGrid/blsGridAsync.html",'<pre> itemsCount : {{ngModel.totalItems}}  options.search.searchText : {{options.search.searchText}} pageIndex : {{options.pagination.pageIndex}} Sorting predicate = {{predicate}}; reverse = {{reverse}}</pre>         <div class="bls-table-container">            <bls-tool-bar></bls-tool-bar>            <div ng-class="{\'overlay\':isLoading}"><div ng-show="isLoading"><div class="double-bounce1"></div><div class="double-bounce2"></div></div></div>            <div><table class="{{gridClass}} blsGrid" id="{{storageIds.colResizeDataKey}}">                    <thead>                        <tr>                            <th class="colHeader" ng-repeat="col in columns" data-original-title="{{col.id}}" ng-click="order(col.id)" ng-class={draggable:{{!isActionCol(col)}}} droppable="{{!isActionCol(col)}}" draggable="{{!isActionCol(col)}}" dragData="{{col.id}}" drop="handleDrop" drag="handleDrag"  dragImage="5">                                            {{col.displayName|uppercase}}                                <i class="pull-left fa fa-sort"  ng-class="glyphOrder(col.id)"></i>                            </th>                        </tr>                    </thead>                    <tbody>                            <tr ng-class="{\'info\':(selectedRows.indexOf(d)>=0)}" ng-click="toggleSelectedRow(d)" ng-repeat="d in data">                                <td ng-repeat="a in columns|filter:{ id:\'!actions\'}">{{d[a.id]}}</td>                                <td ng-if="actionsEnabled" class="center">                                    <a ng-repeat="btn in options.actions" class="btn btn-default {{btn.class}}" ng-click="btn.action(d)" title="{{btn.title}}" ng-class="btn.class"><i class="{{btn.glyphicon}}"></i></a>                                </td>                            </tr>                        </tbody>                    </table>                        <div class="footer">                            <pagination class="col-md-10 col-xs-8" total-items="data.length" ng-model="options.pagination.pageIndex" max-size="options.pagination.pager.maxSize" items-per-page="options.pagination.itemsPerPage.selected" class="pagination-sm" boundary-links="true" rotate="false"></pagination>                            <div class="pagerList col-md-2 col-xs-4">                                    <select class="form-control" id="sel1" ng-model="options.pagination.itemsPerPage.selected" ng-change="updateRecordsCount()" ng-options="c as c for c in options.pagination.itemsPerPage.range" ng-selected="options.pagination.itemsPerPage.selected == c"></select>                            </div>                         </div>            </div>        </div>'),a.put("template/blsGrid/blsGrid.html",'<pre> itemsCount : {{data.length}}  options.search.searchText : {{options.search.searchText}} pageIndex : {{options.pagination.pageIndex}} offset = {{offset}} Sorting predicate = {{predicate}}; reverse = {{reverse}}</pre>         <div class="bls-table-container">            <bls-tool-bar></bls-tool-bar>            <div ng-class="{\'overlay\':isLoading}"><div ng-show="isLoading"><div class="double-bounce1"></div><div class="double-bounce2"></div></div></div>            <div><table class="{{gridClass}} blsGrid" id="{{storageIds.colResizeDataKey}}">                <thead>                    <tr>                        <th class="colHeader" ng-repeat="col in columns" data-original-title="{{col.id}}" ng-click="order(col.id)" ng-class={draggable:{{!isActionCol(col)}}} droppable="{{!isActionCol(col)}}" draggable="{{!isActionCol(col)}}" dragData="{{col.id}}" drop="handleDrop" drag="handleDrag"  dragImage="5">                               {{col.displayName|uppercase}}                            <i class="pull-left fa fa-sort"  ng-class="glyphOrder(col.id)"></i>                        </th>                    </tr>                </thead>                <tbody>                    <tr ng-class="{\'info\':(selectedRows.indexOf(d)>=0)}" bls-slave-view ng-click="toggleSelectedRow(d)" ng-repeat="d in filteredData = (data | filter:options.search.searchText| orderBy:predicate:reverse| limitTo:options.pagination.itemsPerPage.selected:offset)">                        <td ng-repeat="a in columns|filter:{ id:\'!actions\'}">{{d[a.id]}}</td>                        <td ng-if="actionsEnabled" class="center">                            <a ng-repeat="btn in options.actions" class="btn btn-default {{btn.class}}" ng-click="btn.action(d)" title="{{btn.title}}" ng-class="btn.class"><i class="{{btn.glyphicon}}"></i></a>                        </td>                    </tr>                </tbody>            </table>            <div class="footer">                <pagination class="col-md-10 col-xs-8" total-items="data.length" ng-model="options.pagination.pageIndex" max-size="options.pagination.pager.maxSize" items-per-page="options.pagination.itemsPerPage.selected" class="pagination-sm" boundary-links="true" rotate="false"></pagination>                <div class="pagerList col-md-2 col-xs-4">                    <select class="form-control" id="sel1" ng-model="options.pagination.itemsPerPage.selected" ng-change="updateRecordsCount()" ng-options="c as c for c in options.pagination.itemsPerPage.range" ng-selected="options.pagination.itemsPerPage.selected == c"></select>                </div>             </div>            </div>        </div>'),a.put("template/blsGrid/blsGridMasterSlave.html",'<pre> itemsCount : {{data.length}}  options.search.searchText : {{options.search.searchText}} pageIndex : {{options.pagination.pageIndex}} offset = {{offset}} Sorting predicate = {{predicate}}; reverse = {{reverse}}</pre> <div class="bls-table-container">    <bls-tool-bar></bls-tool-bar>    <div ng-class="{\'overlay\':isLoading}"><div ng-show="isLoading"><div class="double-bounce1"></div><div class="double-bounce2"></div></div></div>    <div><table class="{{gridClass}} blsGrid" id="{{storageIds.colResizeDataKey}}">        <thead>            <tr>            <th>&nbsp;</th>                <th class="colHeader" ng-repeat="col in columns" data-original-title="{{col.id}}" ng-click="order(col.id)" ng-class={draggable:{{!isActionCol(col)}}} droppable="{{!isActionCol(col)}}" draggable="{{!isActionCol(col)}}" dragData="{{col.id}}" drop="handleDrop" drag="handleDrag"  dragImage="5">                       {{col.displayName|uppercase}}                    <i class="pull-left fa fa-sort"  ng-class="glyphOrder(col.id)"></i>                </th>            </tr>        </thead>        <tbody>            <tr ng-class="{\'info\':(selectedRows.indexOf(d)>=0)}" ng-click="toggleSelectedRow(d)" ng-repeat="d in filteredData = (data | filter:options.search.searchText| orderBy:predicate:reverse| limitTo:options.pagination.itemsPerPage.selected:offset)">                <td class="expand"><button class="btn btn-default btn-xs" ng-click="ShowSlaveView(d)"><span class="glyphicon glyphicon-eye-open"></span></button></td>                <td ng-repeat="a in columns|filter:{ id:\'!actions\'}">{{d[a.id]}}</td>                <td ng-if="actionsEnabled" class="center">                    <a ng-repeat="btn in options.actions" class="btn btn-default {{btn.class}}" ng-click="btn.action(d)" title="{{btn.title}}" ng-class="btn.class"><i class="{{btn.glyphicon}}"></i></a>                </td>            </tr>        </tbody>    </table>    <div class="footer">        <pagination class="col-md-10 col-xs-8" total-items="data.length" ng-model="options.pagination.pageIndex" max-size="options.pagination.pager.maxSize" items-per-page="options.pagination.itemsPerPage.selected" class="pagination-sm" boundary-links="true" rotate="false"></pagination>        <div class="pagerList col-md-2 col-xs-4">            <select class="form-control" id="sel1" ng-model="options.pagination.itemsPerPage.selected" ng-change="updateRecordsCount()" ng-options="c as c for c in options.pagination.itemsPerPage.range" ng-selected="options.pagination.itemsPerPage.selected == c"></select>        </div>     </div>    </div></div>'),a.put("Views/Partials/slavePostTemplate.html",'<table class="table table-hover table-striped"><tr ng-repeat="c in listData"><td>{{c.id}}</td><td>{{c.name}}</td><td>{{c.email}}</td><td>{{c.body}}</td></tr></table>')}])}(window.angular),function(a){app.directive("blsHeader",["$log","$compile","$templateCache","$timeout","localStorageService",function(b,c,d,e,f){var g='<tr>                        <th class="colHeader" ng-repeat="col in cols" ng-click="order(col)" width="{{getColWidth($index)}}" allow-drag>                                        {{col.title|uppercase}}                            <i ng-if="col.sortable" class="pull-left fa " ng-class="glyphOrder(col)"></i><i ng-if="col.resize" class="resize"></i>                        </th>                   </tr>';return this.link={pre:function(d,h,i,j){d.$on("blsDataGrid_initedEvent",function(i){b.debug("    blsDataGrid_initedEvent intercepted");var k=j[0];j[1];d.setPredicate(f.get(d.storageIds.predicateId)||(void 0==d.cols[0]?"":d.cols[0].id)),d.refreshDataGrid=k.refreshDataGrid,b.debug("    Link => blsHeader");var l=a.element(g);d.getColWidth=function(a){return k.tableConfig.cols[a].width>0?k.tableConfig.cols[a].width+"px":void 0},e(function(){h.siblings("table").find("thead").append(l),b.debug("    compiling blsHeader"),c(l)(d)},0)})}},this.controller=["$scope","$filter","$timeout","$element","$log","localStorageService","dropableservice",function(b,c,d,e,f,g,h){function i(b){j.resizePressed&&(start.width=startWidth+(b.pageX-startX),j.resizeColData={index:a.element(b.target).scope().$index,width:start.width})}var j=this;j.reverse=g.get(b.storageIds.reverseId)||j.reverse,j.resizeColData=null,j.resizePressed=!1,f.debug("    blsHeader controller: in init..."),b.setPredicate=function(a){j.predicate=a},b.glyphOrder=function(a){return f.debug("    glyphOrder function was called"),a.fieldName!=b.predicate?"fa-sort":j.reverse?"fa-sort-asc":"fa-sort-desc"},b.order=function(a){j.resizePressed||a.sortable&&(f.debug("    order function was called"),j.reverse=b.predicate===a.fieldName?!j.reverse:!1,j.predicate=a.fieldName,b.saveUserData({key:b.storageIds.predicateId,val:j.predicate}),b.saveUserData({key:b.storageIds.reverseId,val:j.reverse}),b.refreshDataGrid())},b.resizeStart=function(a){var c=a.target?a.target:a.srcElement;c.classList.contains("resize")&&(start=c.parentNode,j.resizePressed=!0,startX=a.pageX,startWidth=c.parentNode.offsetWidth,document.addEventListener("mousemove",i),document.addEventListener("mouseup",b.resizeEnd),a.stopPropagation(),a.preventDefault())},b.resizeEnd=function(a){return j.resizePressed?(document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",b.resizeEnd),a.stopPropagation(),a.preventDefault(),setTimeout(function(){j.resizePressed=!1},50),b.setColWidth(j.resizeColData.index,j.resizeColData.width),j.resizeColData=null,!1):void 0}}],{priority:-20,require:["^?blsTable","blsHeader"],restrict:"E",link:this.link,controller:controller}}])}(window.angular),function(a){app.directive("blsRows",["$log","$compile","$templateCache","$timeout",function(b,c,d,e){var f='<tr ng-repeat="d in data" ><td ng-repeat="c in cols" dynamic="getTdTpl(c)">{{d[c.fieldName]}}</td></tr>';return this.link=function(b,d,g,h){var i=a.element(f);b.isHierarchical()&&i.attr("bls-row-child",""),e(function(){d.siblings("table").find("tbody").append(i),c(i)(b)},0)},{require:["^blsTable"],priority:-17,restrict:"E",link:this.link,scope:!0}}]).directive("blsRowChild",["$log","$compile","$templateCache","$timeout",function(b,c,d,e){var f='<tr ng-repeat="d in data" data-bls-id="{{$id}}" parentId="{{parentId}}" bls-row-child func="getChildren" data-level="{{level}}"><td ng-repeat="c in cols" dynamic="getTdTpl(c)">{{d[c.fieldName]}}</td></tr>',g='<i id="{{$id}}" class="fa {{expand?\'fa-caret-down\':\'fa-caret-right\'}}" style="padding:0 4px 0 {{5+(15*level)}}px"></i>';return this.link=function(d,h,i,j,k){b.debug("    Link => blsRows");var l=this;this.childs=[];var m=a.element(g);d.expand=!1,d.firstExpand=!0,this.getRowsChilds=function(b,c){var d=c.siblings('tr[parentId="'+b+'"]').toArray();l.childs=l.childs.concat(d);for(var e=0;e<d.length;e++)l.childs.concat(getRowsChilds(a.element(d[e]).data("blsId"),$(d[e])));return l.childs},d.getTdTpl=function(a,b){return""!=a.tpl?(a.tpl=a.tpl.replace("::data","d"),a.tpl.replace("::field","d[c.fieldName]")):void 0};var n=a.element(f);a.isDefined(i.level)||(d.level=0,h.data("dataLevel",d.level)),e(function(){this.toggle=function(a,b,c){l.childs=l.getRowsChilds(a,b),l.childs.forEach(function(a){c?$(a).show():$(a).hide()})},m.on("click",function(a){b.debug("    toggle row");var e=$(this);if(d.firstExpand){m.addClass("fa-spinner"),d.firstExpand=!1;var f=d.$new();d.getChildren()(d.d).then(function(a){m.removeClass("fa-spinner"),a.data.length>0?(f.data=a.data,f.level=d.level+1,f.parentId=d.$id,c(n)(f),d.expand=!d.expand,l.toggle(d.$id,e.closest("tr"),d.expand),n.insertAfter(h)):m.removeClass("fa").removeClass("fa-caret-down").removeClass("fa-caret-right").off("click")})}else d.$apply(function(){d.expand=!d.expand,l.toggle(d.$id,e.closest("tr"),d.expand)})}),c(m)(d),a.element(h.find("td")[0]).prepend(m)},0)},{require:["^blsTable"],priority:-16,restrict:"A",link:this.link,scope:!0}}]).directive("dynamic",["$log","$compile",function(a,b){return{restrict:"A",replace:!0,link:function(c,d,e){c.$watch(e.dynamic,function(e){a.debug("       in dynamic html"),d.html(e),b(d.contents())(c)})}}}])}(window.angular),function(a){app.directive("blsTable",["$log","$compile","$templateCache","$timeout","dropableservice",function(b,c,d,e,f){return this.tpl=d.get("templates/blsTable.html"),this.controller=["$scope","$attrs","$filter","$timeout","$element","$log","localStorageService","dropableservice",function(b,c,d,e,f,g,h,i){var j=this;j.initialLoad=b.isLoading=!0,this.tableConfig={},b.uniqueId="blsContainer_"+b.$id,b.storageIds={predicateId:"prd_"+b.uniqueId,reverseId:"rvs_"+b.uniqueId,itemsPerPageId:"ipp_"+b.uniqueId,tableConfig:"tblConfig_"+b.uniqueId,colReorderDataKey:"crdKey_"+b.uniqueId,colResizeDataKey:"crsKey_"+b.uniqueId};var k={multiSelection:!0,search:{searchText:"",searchClass:"form-control"},pagination:{pageLength:5,pageIndex:1,pager:{nextTitle:"Suivant",perviousTitle:"Précédent",maxSize:3},itemsPerPage:{prefixStorage:"ipp_",selected:10,range:[10,20]}}};b.options=a.extend({},k,b.options),b.options.pagination.itemsPerPage&&b.options.pagination.itemsPerPage.range&&b.options.pagination.itemsPerPage.range.indexOf(b.options.pagination.pageLength)<1&&(b.options.pagination.pageLength=h.get(b.storageIds.itemsPerPageId)||b.options.pagination.itemsPerPage.range[0]),b.$watch("options.pagination.pageIndex",function(a,c){a!=c&&(b.options.pagination.pageIndex=a++,j.refreshDataGrid())}),b.updateRecordsCount=function(){b.saveUserData({key:b.storageIds.itemsPerPageId,val:b.options.pagination.itemsPerPage.selected}),b.options.pagination.pageLength=b.options.pagination.itemsPerPage.selected,j.refreshDataGrid()},this.refreshDataGrid=function(){a.isDefined(b.funcAsync)&&(j.initColConfig(),b.isLoading=!0,b.reverse=h.get(b.storageIds.reverseId),b.predicate=h.get(b.storageIds.predicateId)||(void 0==b.cols[0]?"":b.cols[0].id),b.funcAsync({pageIndex:b.options.pagination.pageIndex,pageLength:b.options.pagination.itemsPerPage.selected,searchedText:b.options.search.searchText,orderBy:b.predicate,order:b.reverse}))},this.setCols=function(a){b.cols=a,b.$emit("blsDataGrid_initedEvent"),g.debug("cols =>",b.cols),j.initColConfig(),j.refreshDataGrid()},this.changeColumnsOrder=function(a,c){b.$applyAsync(function(){b.data.swap(a,c),b.cols.swap(a,c),j.tableConfig.cols.swap(a,c),b.saveUserData({key:b.storageIds.tableConfig,val:j.tableConfig})})},b.setColWidth=function(a,c){g.debug("setColWidth => ",a," width = ",c),j.tableConfig.cols[a].width=c,b.saveUserData({key:b.storageIds.tableConfig,val:j.tableConfig})},b.$watch("options.search.searchText",function(a,b){j.timerSearch&&e.cancel(j.timerSearch),a!=b&&(j.timerSearch=e(function(){j.refreshDataGrid()},500))}),b.$watch("data",function(a,c){a!=c&&b.cols.length>0&&(g.debug("init Table config"),j.initTableConfig())}),this.initColConfig=function(){if(h.isSupported&&(j.tableConfig=h.get(b.storageIds.tableConfig)),null==j.tableConfig){j.tableConfig={id:b.uniqueId,cols:[]};for(var a=0;a<=b.cols.length-1;a++)j.tableConfig.cols.push({index:a,width:-1});b.saveUserData({key:b.storageIds.tableConfig,val:j.tableConfig})}},this.initTableConfig=function(){if(j.initialLoad){for(var a=0;a<=j.tableConfig.cols.length-1;a++)if(a!=j.tableConfig.cols[a].index){if(a>j.tableConfig.cols[a].index)continue;g.debug("swap form ",a," to => ",j.tableConfig.cols[a].index),b.data.swap(a,j.tableConfig.cols[a].index),b.cols.swap(a,j.tableConfig.cols[a].index)}j.initialLoad=!1}b.isLoading=!1},b.saveUserData=function(a){h.isSupported&&h.set(a.key,a.val)},b.$on("flushEvent",function(a){g.debug(h.keys()),g.debug("clearUserDataEvent intercepted => $scope.uniqueId : ",b.uniqueId),h.isSupported&&h.clearAll("^(.)+"+b.uniqueId+"$")}),b.$on("refreshEvent",function(a){g.debug("refreshEvent intercepted"),j.refreshDataGrid()}),b.$on("exportEvent",function(a,b){g.debug("exportEvent intercepted to type : ",b),f.find("table").tableExport({type:b})}),b.$on("$destroy",function(a){e.cancel(j.timerSearch)}),b.isHierarchical=function(){return a.isDefined(c.getChildren)}}],{restrict:"E",replace:!0,transclude:!0,template:this.tpl,controller:this.controller,scope:{data:"=ngModel",funcAsync:"&",getChildren:"&",options:"=",totalItems:"="}}}])}(window.angular),app.directive("blsDropDown",["$log",function(a){var b='<div class="dropdown">                  <button class="btn btn-default btn-sm dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">                    {{title}}                    <span class="caret"></span>                  </button>                  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1" >                    <li ng-repeat="link in links"><a ng-click="func()(link)">{{link}}</a></li>                  </ul>             </div>';return{template:b,replace:!0,scope:{links:"=",title:"=",func:"&"},link:function(a,b,c){}}}]),app.directive("blsToolBar",[function(){return{priority:2,scope:!0,restrict:"E",template:'<div class="row">                       <div class="btn-toolbar pull-right col-xs-12" role="toolbar">                            <div class="btn-group btn-group-sm pull-right ">                                <bls-drop-down links="links" func="export" title="titleExportButton" ></bls-drop-down>                                <button type="button" class="{{btnClass}}" tooltip="Settings" aria-label="Right Align"><span class="fa fa-cog" aria-hidden="true"></span></button>                                <button type="button" ng-click="clearUserData()" class="{{btnClass}}" tooltip="Reset" aria-label="Right Align"><span class="fa fa-recycle" aria-hidden="true"></span></button>                                <button type="button" ng-click="refresh()" class="{{btnClass}}" tooltip="Refresh" aria-label="Right Align"><span class="fa fa-refresh" aria-hidden="true"></span></button>                                <button type="button" ng-click="toggleSelectAll()" class="{{btnClass}}" tooltip="{{selectedAll?\'Deselect all\':\'Select all\'}}" aria-label="Right Align"><span class="glyphicon " ng-class="selectedAll?\'glyphicon-unchecked\':\'glyphicon-check\'" aria-hidden="true"></span></button>                            </div>                            <form action="" class="search-form pull-right col-md-2 col-xs-12">                                <div class="form-group has-feedback">                                    <label for="search" class="sr-only">Search</label>                                    <input type="text" class="{{options.search.searchClass}}" name="search" id="search" placeholder="{{searchPlaceHolder}}" ng-model="options.search.searchText">                                    <span class="glyphicon glyphicon-search form-control-feedback"></span>                                </div>                            </form>                        </div>                 </div>',replace:!0,controller:function(a,b,c,d){a.btnClass="btn btn-default",a.searchPlaceHolder="search...",a.selectedAll=!1,a.titleExportButton="Export",a.clearUserData=function(){a.$emit("flushEvent")},a.refresh=function(){a.$emit("refreshEvent")},a.toggleSelectAll=function(){a.selectedAll=!a.selectedAll,a.$emit("toggleSelectAllEvent",a.selectedAll)},a["export"]=function(b){d.debug("    export type => ",b),a.$emit("exportEvent",b)},a.links=["excel","xml","csv","sql","json","doc","powerpoint"]}}}]),function(a){"use strict";app.directive("blsTr",function(b,c,d,e){var f={post:function(c,f,g,h){h[1],h[0];a.isDefined(c.row)||(c.row=c.$eval(g.blsTr)),a.isDefined(c.columns)||(c.columns=c.$parent.$parent.columns),a.isDefined(c.config)||(c.config=c.$eval(g.config)),a.isDefined(c.nestedDataFunc)||(c.nestedDataFunc=c.$eval(g.nestedDataFunc)),a.isDefined(c.index)||(c.index=c.$eval(g.index)),
c.config?(c.config.level++,c.childConfig={level:c.config.level+1,collapsed:!0,loaded:!1}):c.config={level:0,collapsed:!0,loaded:!1},e.debug("config  ===== ",c.config),e.debug("**************************  start compile blsTr"),c.tpl=a.element(d.get("templates/blsTr.html")),f.replaceWith(c.tpl),b(c.tpl)(c)}};return{restrict:"A",require:["^?blsNestedGrid","blsTr"],link:f,scope:{},controller:["$scope","$element","$attrs","$log","$compile","$templateCache",function(b,c,d,e,f,g){e.debug("row = ",b.row),b.expand=function(){e.debug("expanding data"),b.config.collapsed=!b.config.collapsed,b.config.loaded||(b.config.loaded=!0,b.nestedDataFunc()(b.row).then(function(d){a.isArray(d.data)||(d.data=[d.data]),a.forEach(d.data,function(a,g){var h=b.$new(!0);h.nestedDataFunc=b.nestedDataFunc(),h.columns=b.columns,h.row=a,h.index=b.index+1,h.config={level:b.config.level+1,collapsed:!0,loaded:!1},f(b.tpl)(h),b.tpl.insertAfter(c),e.debug("childs length : ",d.data)}),b.$parent.data.splice(b.index+1,0,d.data)}))},b.collpaseState=function(b){return a.isDefined(b)?b.collapsed?"fa-caret-right":"fa-caret-down":void 0}}]}})}(window.angular),app.directive("allowDrag",function(){return{restrict:"A",require:["^blsTable"],controller:function(){},compile:function(a,b){function c(a,b){var c=a[0].parentNode.querySelector("."+b);c&&c.classList.remove(b)}return function(a,b,d,e){var f=e[0];b.attr("draggable",!0),b.bind("dragstart",function(a){f.target=this,this.classList.add("dragged"),a.originalEvent.dataTransfer.setData("text",f.target.cellIndex)}),b.bind("dragover",function(a){a.preventDefault()}),b.bind("dragenter",function(a){f.toTarget=this,this.classList.contains("draggedOver")||this.classList.contains("dragged")||this.classList.add("draggedOver"),a.preventDefault(),a.stopPropagation()}),b.bind("dragend",function(a){this.classList.contains("dragged")&&this.classList.remove("dragged"),a.preventDefault()}),b.bind("dragleave",function(a){this.classList.remove("draggedOver")}),b.bind("drop",function(a){var d=f.toTarget.cellIndex,e=parseInt(a.originalEvent.dataTransfer.getData("text"),10);c(b,"dragged"),c(b,"draggedOver"),f.changeColumnsOrder(d,e),a.preventDefault()})}}}}),app.directive("droppable",["$parse",function(a){return{link:function(b,c,d){function e(a){return console.log("drag over"),a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.originalEvent.dataTransfer.dropEffect="move",!1}function f(c){console.log("onDrop"),c.preventDefault&&c.preventDefault(),c.stopPropagation&&c.stopPropagation();var e=c.originalEvent.dataTransfer.getData("Text");e=angular.fromJson(e);var f=d.drop;a(d.drop);b.$apply(function(){b[f](e,c.target)})}c.bind("dragover",e),c.bind("drop",f)}}}]),app.directive("draggable",function(){return{link:function(a,b,c){b.attr("draggable",!0);var d="",e="";c.$observe("dragdata",function(a){d=a}),c.$observe("dragimage",function(a){e=a}),b.bind("dragstart",function(b){var e=angular.toJson(d);b.originalEvent.dataTransfer.setData("Text",e);var f=c.drag;"undefined"!==f&&a.$apply(function(){a[f](e)})})}}}),app.directive("hfGrid",["$log","$templateRequest","$compile","localStorageService",function(a,b,c,d){var e={post:function(b,c,d,e){a.debug("_______in post hfGrid")}},f=function(a,b,c,d,e){c.debug("in hfGrid");var f=this;a.rows=a.cols=[],a.uniqueId="hfGrid_"+b[0].id,a.sort=a.pagination={},a.isSortInited=!1,a.core={isLoading:!0,isFirstLoad:!0},this.reloadData=function(){a.core.isLoading=!0,a.source()(a.pagination.pageIndex,a.pagination.itemsPerPage,a.pagination.searchedText,a.sort.orderBy,a.sort.order).then(function(f){c.debug("dataSource => ",f),a.rows=f.data,a.core.isLoading=!1,a.core.isFirstLoad&&d("templates/hfGridTpl.html").then(function(d){c.debug("**************************  start compile"),elem=e(d)(a),b.html(elem),a.core.isFirstLoad=!1})})},a.$on("hfGridPaginationChanged",function(b,d){c.debug("on hfGridPaginationChanged intercepted"),a.pagination=d,f.reloadData()}),a.$on("hfGridSortChanged",function(b,d){c.debug("on hfGridSortChanged intercepted"),a.sort=d,f.reloadData()}),this.setSort=function(b){b!=a.sort&&(c.debug("set Sort"),a.sort=b)},this.getSort=function(){return a.sort},this.setCols=function(b){a.cols=b,c.debug("settings cols => ",a.cols)},this.getIsSortInited=function(){return a.isSortInited},this.setIsSortInited=function(b){a.isSortInited=b}};return{controller:f,restrict:"E",link:e,scope:{source:"&",childSource:"&"}}}]).directive("hfGridColumns",["$log",function(a){var b=function(b,c,d,e){var f=e[0],g=e[1];f.setCols(g.getCols()),a.debug("link hfGridColumns")},c=function(a,b,c){var d=[];this.addCol=function(a){d.push(a),c.debug("columns : ",a)},this.getCols=function(){return d}};return{require:["^hfGrid","hfGridColumns"],link:b,controller:c}}]).directive("hfGridColumn",["$log",function(a){var b=function(b,c,d,e){a.debug("link hfGridColumn"),e.addCol({title:d.title,field:d.field,sortable:angular.isDefined(d.sortable),editable:angular.isDefined(d.editable),filterable:angular.isDefined(d.editable)})},c=function(a,b,c){};return{require:"^hfGridColumns",link:b,restrict:"E",controller:c}}]).directive("hfGridChilren",["$log","$compile",function(a,b){var c={pre:function(b,c,d,e){a.debug("=> pre link hfGridChilren"),c.removeAttr("hf-grid-sortable")},post:function(c,d,e,f){a.debug("=> post link hfGridChilren");var g=f[0],h=f[1];d.on("click",function(){c.onSort(c.col)}),g.getIsSortInited()?c.sort=g.getSort():(a.debug("Sort is not inited !!!!!"),h.init(),g.setIsSortInited(!0),g.setSort(c.sort));var i=angular.element('<i ng-if="col.sortable" class="pull-left fa fa-sort " ng-click="onSort(col)" ng-class="glyphOrder(col)"></i>');d.append(b(i)(c))}},d=function(a,b,c){};return{require:["^hfGrid","hfGridSortable"],link:c,restrict:"A",controller:d,priority:-9}}]).directive("hfGridSortable",["$log","$compile",function(a,b){var c={pre:function(b,c,d,e){a.debug("=> pre link hfGridSortable"),c.removeAttr("hf-grid-sortable")},post:function(c,d,e,f){a.debug("=> post link hfGridSortable");var g=f[0],h=f[1];d.on("click",function(){c.onSort(c.col)}),g.getIsSortInited()?c.sort=g.getSort():(a.debug("Sort is not inited !!!!!"),h.init(),g.setIsSortInited(!0),g.setSort(c.sort));var i=angular.element('<i ng-if="col.sortable" class="pull-left fa fa-sort " ng-click="onSort(col)" ng-class="glyphOrder(col)"></i>');d.append(b(i)(c))}},d=function(a,b,c,d){var e=this,f="_orderBy",g="_order";a.sort={},a.onSort=function(b){c.debug("sorting on ",b.field),a.sort.order=b.field==a.sort.orderBy?!a.sort.order:a.sort.order,a.sort.orderBy=b.field,e.saveUserData(),a.$emit("hfGridSortChanged",a.sort)},a.glyphOrder=function(b){return c.debug("glyphOrder => sort",a.sort,b.field),b.field!=a.sort.orderBy?"":a.sort.order?"fa-sort-asc":"fa-sort-desc"},this.saveUserData=function(){d.isSupported&&(d.set(a.uniqueId+f,a.sort.orderBy),d.set(a.uniqueId+g,a.sort.order))},this.init=function(){d.isSupported&&(a.sort.orderBy=d.get(a.uniqueId+f),a.sort.order=d.get(a.uniqueId+g))}};return{require:["^hfGrid","hfGridSortable"],link:c,restrict:"A",controller:d,priority:-10}}]).directive("hfPagination",["$log",function(a){var b=function(b,c,d,e){a.debug("in link hfPagination");e[0];b.pagination={pageIndex:1,searchedText:"",totalItems:!1},d.$observe("totalItems",function(c,e){c!=e&&(b.pagination.totalItems=c,b.pagination.itemsPerPage=b.$eval(d.itemsPerPage),b.pagination.range=b.$eval(d.range),b.pagination.totalItems=b.$eval(d.totalItems),b.pagination.maxSize=b.$eval(d.maxSize),a.debug("pagination.totalItems => ",b.pagination.totalItems))})},c=function(a,b,c){a.$watch("pagination",function(b,d){a.pagination.totalItems&&(b.pageIndex==d.pageIndex&&(a.pagination.pageIndex=1),c.debug("pagination changed fired"),a.$broadcast("hfGridPaginationChanged",a.pagination))},!0)};return{require:["^hfGrid"],link:b,restrict:"E",controller:c}}]),app.directive("panel",function(){return{link:function(a,b,c){a.dataSource="directive"},restrict:"E",scope:!0,template:function(){return angular.element(document.querySelector("#template")).html()},transclude:!0}}),app.service("dropableservice",function(a,b){Array.prototype.swap=function(a,b){if(a>=this.length)for(var c=a-this.length;c--+1;)this.push(void 0);return this.splice(a,0,this.splice(b,1)[0]),this},this.defaultColConfig=function(a){for(var b=new Array(a),c=b.length-1;c>=0;c--)b[c]=c;return b},this.swapArrayElements=function(a,b,c){var d=a[b];a[b]=a[c],a[c]=d},this.initReorderColumns=function(a,c,d){var e=b.get(d);(null==e||0==e.length)&&(e=this.defaultColConfig(a.length));for(var f=this,g=0;g<e.length-2;g++)if(g!=e[g]){if(g>e[g]&&g==e[e.indexOf(g)])continue;f.swapArrayElements(a,g,e.indexOf(g)),f.swapArrayElements(c,g,e.indexOf(g))}return e},this.saveConfig=function(c,d){b.isSupported&&(a.info("saveConfig  : "+d),a.info("saveConfig key : "+c),b.set(c,d))}});